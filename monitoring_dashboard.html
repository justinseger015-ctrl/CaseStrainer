<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CaseStrainer Production Monitor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .status-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .status-card.healthy {
            border-left: 5px solid #28a745;
        }

        .status-card.warning {
            border-left: 5px solid #ffc107;
        }

        .status-card.error {
            border-left: 5px solid #dc3545;
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
            animation: pulse 2s infinite;
        }

        .status-indicator.healthy {
            background-color: #28a745;
        }

        .status-indicator.warning {
            background-color: #ffc107;
        }

        .status-indicator.error {
            background-color: #dc3545;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .card-content {
            color: #666;
            line-height: 1.6;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-weight: 500;
            color: #555;
        }

        .metric-value {
            font-weight: 600;
            color: #333;
        }

        .uptime-display {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .uptime-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .uptime-icon {
            font-size: 2rem;
            margin-right: 15px;
            color: #28a745;
        }

        .uptime-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
        }

        .uptime-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .uptime-metric {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .uptime-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #28a745;
            margin-bottom: 5px;
        }

        .uptime-label {
            font-size: 0.9rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .controls {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .refresh-info {
            color: #666;
            font-size: 0.9rem;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .status-grid {
                grid-template-columns: 1fr;
            }
            
            .uptime-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç CaseStrainer Production Monitor</h1>
            <p>Real-time system health and performance monitoring</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <button class="btn btn-primary" onclick="refreshData()">üîÑ Refresh Now</button>
                <button class="btn btn-success" onclick="toggleAutoRefresh()">‚è±Ô∏è Auto Refresh: <span id="autoRefreshStatus">ON</span></button>
                <button class="btn btn-warning" onclick="openHealthEndpoint()">üîó View Raw Data</button>
                <span class="refresh-info">Last updated: <span id="lastUpdate">Never</span></span>
            </div>
        </div>

        <div id="errorContainer" style="display: none;"></div>

        <div id="loadingContainer" class="loading">
            <div class="spinner"></div>
            <p>Loading system status...</p>
        </div>

        <div id="contentContainer" style="display: none;">
            <div class="uptime-display">
                <div class="uptime-header">
                    <div class="uptime-icon">‚è∞</div>
                    <div class="uptime-title">System Uptime</div>
                </div>
                <div class="uptime-grid">
                    <div class="uptime-metric">
                        <div class="uptime-value" id="serverUptime">--</div>
                        <div class="uptime-label">Server Uptime</div>
                    </div>
                    <div class="uptime-metric">
                        <div class="uptime-value" id="workerUptime">--</div>
                        <div class="uptime-label">Worker Uptime</div>
                    </div>
                    <div class="uptime-metric">
                        <div class="uptime-value" id="lastHealthCheck">--</div>
                        <div class="uptime-label">Last Health Check</div>
                    </div>
                    <div class="uptime-metric">
                        <div class="uptime-value" id="responseTime">--</div>
                        <div class="uptime-label">Response Time</div>
                    </div>
                </div>
            </div>

            <div class="status-grid">
                <div class="status-card" id="flaskCard">
                    <div class="card-header">
                        <div class="status-indicator" id="flaskStatus"></div>
                        <div class="card-title">Flask Application</div>
                    </div>
                    <div class="card-content">
                        <div class="metric">
                            <span class="metric-label">Status:</span>
                            <span class="metric-value" id="flaskStatusText">Unknown</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Version:</span>
                            <span class="metric-value" id="flaskVersion">--</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Environment:</span>
                            <span class="metric-value" id="flaskEnv">--</span>
                        </div>
                    </div>
                </div>

                <div class="status-card" id="redisCard">
                    <div class="card-header">
                        <div class="status-indicator" id="redisStatus"></div>
                        <div class="card-title">Redis Database</div>
                    </div>
                    <div class="card-content">
                        <div class="metric">
                            <span class="metric-label">Status:</span>
                            <span class="metric-value" id="redisStatusText">Unknown</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Connection:</span>
                            <span class="metric-value" id="redisConnection">--</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Memory Usage:</span>
                            <span class="metric-value" id="redisMemory">--</span>
                        </div>
                    </div>
                </div>

                <div class="status-card" id="workerCard">
                    <div class="card-header">
                        <div class="status-indicator" id="workerStatus"></div>
                        <div class="card-title">RQ Worker</div>
                    </div>
                    <div class="card-content">
                        <div class="metric">
                            <span class="metric-label">Status:</span>
                            <span class="metric-value" id="workerStatusText">Unknown</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Active Jobs:</span>
                            <span class="metric-value" id="activeJobs">--</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Queue Size:</span>
                            <span class="metric-value" id="queueSize">--</span>
                        </div>
                    </div>
                </div>

                <div class="status-card" id="databaseCard">
                    <div class="card-header">
                        <div class="status-indicator" id="databaseStatus"></div>
                        <div class="card-title">SQLite Database</div>
                    </div>
                    <div class="card-content">
                        <div class="metric">
                            <span class="metric-label">Status:</span>
                            <span class="metric-value" id="databaseStatusText">Unknown</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Connection:</span>
                            <span class="metric-value" id="databaseConnection">--</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">File Size:</span>
                            <span class="metric-value" id="databaseSize">--</span>
                        </div>
                    </div>
                </div>

                <div class="status-card" id="systemCard">
                    <div class="card-header">
                        <div class="status-indicator" id="systemStatus"></div>
                        <div class="card-title">System Resources</div>
                    </div>
                    <div class="card-content">
                        <div class="metric">
                            <span class="metric-label">CPU Usage:</span>
                            <span class="metric-value" id="cpuUsage">--</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Memory Usage:</span>
                            <span class="metric-value" id="memoryUsage">--</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Disk Usage:</span>
                            <span class="metric-value" id="diskUsage">--</span>
                        </div>
                    </div>
                </div>

                <div class="status-card" id="overallCard">
                    <div class="card-header">
                        <div class="status-indicator" id="overallStatus"></div>
                        <div class="card-title">Overall System Health</div>
                    </div>
                    <div class="card-content">
                        <div class="metric">
                            <span class="metric-label">Status:</span>
                            <span class="metric-value" id="overallStatusText">Unknown</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Components:</span>
                            <span class="metric-value" id="healthyComponents">--</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Last Error:</span>
                            <span class="metric-value" id="lastError">None</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let autoRefreshInterval;
        let autoRefreshEnabled = true;
        const REFRESH_INTERVAL = 30000; // 30 seconds

        // Configuration - Update this URL to match your production server
        const HEALTH_ENDPOINT = 'https://your-production-domain.com/health';
        // For local testing, use: const HEALTH_ENDPOINT = 'http://localhost:5000/health';

        function formatUptime(seconds) {
            if (!seconds) return 'Unknown';
            
            const days = Math.floor(seconds / 86400);
            const hours = Math.floor((seconds % 86400) / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            
            if (days > 0) {
                return `${days}d ${hours}h ${minutes}m`;
            } else if (hours > 0) {
                return `${hours}h ${minutes}m`;
            } else {
                return `${minutes}m`;
            }
        }

        function formatBytes(bytes) {
            if (!bytes) return 'Unknown';
            
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(1024));
            return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
        }

        function formatTime(timestamp) {
            if (!timestamp) return 'Unknown';
            
            const date = new Date(timestamp * 1000);
            return date.toLocaleString();
        }

        function updateStatusIndicator(element, status) {
            element.className = `status-indicator ${status}`;
        }

        function updateCardStatus(cardId, status) {
            const card = document.getElementById(cardId);
            card.className = `status-card ${status}`;
        }

        function showError(message) {
            const errorContainer = document.getElementById('errorContainer');
            errorContainer.innerHTML = `<div class="error-message">‚ùå Error: ${message}</div>`;
            errorContainer.style.display = 'block';
        }

        function hideError() {
            document.getElementById('errorContainer').style.display = 'none';
        }

        function updateLastUpdate() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = now.toLocaleString();
        }

        async function refreshData() {
            const loadingContainer = document.getElementById('loadingContainer');
            const contentContainer = document.getElementById('contentContainer');
            
            loadingContainer.style.display = 'block';
            contentContainer.style.display = 'none';
            hideError();

            try {
                const startTime = Date.now();
                const response = await fetch(HEALTH_ENDPOINT);
                const responseTime = Date.now() - startTime;
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                // Update response time
                document.getElementById('responseTime').textContent = `${responseTime}ms`;

                // Update uptime information
                document.getElementById('serverUptime').textContent = formatUptime(data.server_uptime);
                document.getElementById('workerUptime').textContent = formatUptime(data.worker_uptime);
                document.getElementById('lastHealthCheck').textContent = formatTime(data.timestamp);

                // Update Flask status
                const flaskStatus = data.flask_status?.status || 'unknown';
                document.getElementById('flaskStatusText').textContent = flaskStatus;
                document.getElementById('flaskVersion').textContent = data.flask_status?.version || '--';
                document.getElementById('flaskEnv').textContent = data.flask_status?.environment || '--';
                updateStatusIndicator(document.getElementById('flaskStatus'), flaskStatus);
                updateCardStatus('flaskCard', flaskStatus);

                // Update Redis status
                const redisStatus = data.redis_status?.status || 'unknown';
                document.getElementById('redisStatusText').textContent = redisStatus;
                document.getElementById('redisConnection').textContent = data.redis_status?.connected ? 'Connected' : 'Disconnected';
                document.getElementById('redisMemory').textContent = formatBytes(data.redis_status?.memory_usage);
                updateStatusIndicator(document.getElementById('redisStatus'), redisStatus);
                updateCardStatus('redisCard', redisStatus);

                // Update Worker status
                const workerStatus = data.worker_status?.status || 'unknown';
                document.getElementById('workerStatusText').textContent = workerStatus;
                document.getElementById('activeJobs').textContent = data.worker_status?.active_jobs || '--';
                document.getElementById('queueSize').textContent = data.worker_status?.queue_size || '--';
                updateStatusIndicator(document.getElementById('workerStatus'), workerStatus);
                updateCardStatus('workerCard', workerStatus);

                // Update Database status
                const databaseStatus = data.database_status?.status || 'unknown';
                document.getElementById('databaseStatusText').textContent = databaseStatus;
                document.getElementById('databaseConnection').textContent = data.database_status?.connected ? 'Connected' : 'Disconnected';
                document.getElementById('databaseSize').textContent = formatBytes(data.database_status?.file_size);
                updateStatusIndicator(document.getElementById('databaseStatus'), databaseStatus);
                updateCardStatus('databaseCard', databaseStatus);

                // Update System status
                const systemStatus = data.system_status?.status || 'unknown';
                document.getElementById('cpuUsage').textContent = data.system_status?.cpu_usage ? `${data.system_status.cpu_usage}%` : '--';
                document.getElementById('memoryUsage').textContent = data.system_status?.memory_usage ? `${data.system_status.memory_usage}%` : '--';
                document.getElementById('diskUsage').textContent = data.system_status?.disk_usage ? `${data.system_status.disk_usage}%` : '--';
                updateStatusIndicator(document.getElementById('systemStatus'), systemStatus);
                updateCardStatus('systemCard', systemStatus);

                // Update Overall status
                const overallStatus = data.overall_status || 'unknown';
                document.getElementById('overallStatusText').textContent = overallStatus;
                document.getElementById('healthyComponents').textContent = data.healthy_components || '--';
                document.getElementById('lastError').textContent = data.last_error || 'None';
                updateStatusIndicator(document.getElementById('overallStatus'), overallStatus);
                updateCardStatus('overallCard', overallStatus);

                updateLastUpdate();
                
            } catch (error) {
                console.error('Error fetching health data:', error);
                showError(`Failed to fetch health data: ${error.message}`);
                
                // Set all status indicators to error
                ['flaskStatus', 'redisStatus', 'workerStatus', 'databaseStatus', 'systemStatus', 'overallStatus'].forEach(id => {
                    updateStatusIndicator(document.getElementById(id), 'error');
                });
                
                ['flaskCard', 'redisCard', 'workerCard', 'databaseCard', 'systemCard', 'overallCard'].forEach(id => {
                    updateCardStatus(id, 'error');
                });
            } finally {
                loadingContainer.style.display = 'none';
                contentContainer.style.display = 'block';
            }
        }

        function toggleAutoRefresh() {
            autoRefreshEnabled = !autoRefreshEnabled;
            const statusElement = document.getElementById('autoRefreshStatus');
            
            if (autoRefreshEnabled) {
                statusElement.textContent = 'ON';
                startAutoRefresh();
            } else {
                statusElement.textContent = 'OFF';
                stopAutoRefresh();
            }
        }

        function startAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            autoRefreshInterval = setInterval(refreshData, REFRESH_INTERVAL);
        }

        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
        }

        function openHealthEndpoint() {
            window.open(HEALTH_ENDPOINT, '_blank');
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            refreshData();
            if (autoRefreshEnabled) {
                startAutoRefresh();
            }
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            stopAutoRefresh();
        });
    </script>
</body>
</html> 