<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Progress UI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .progress-container {
            margin: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .spinner-test {
            width: 2rem;
            height: 2rem;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1>Progress UI Debug Test</h1>
        
        <div class="progress-container">
            <h3>Test 1: Basic Progress Bar</h3>
            <div class="progress mb-3" style="height: 30px;">
                <div id="progressBar1" class="progress-bar progress-bar-striped progress-bar-animated" 
                     role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    <span id="progressText1">0%</span>
                </div>
            </div>
            <button id="testBtn1" class="btn btn-primary">Start Test Progress</button>
        </div>
        
        <div class="progress-container">
            <h3>Test 2: Spinner Animation</h3>
            <div id="spinner1" class="spinner-border text-primary spinner-test" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <div id="spinner2" class="spinner-test border border-primary rounded-circle" style="border-width: 3px!important;">
                <div class="text-center mt-1">ðŸ”„</div>
            </div>
            <button id="testBtn2" class="btn btn-success">Toggle Spinners</button>
        </div>
        
        <div class="progress-container">
            <h3>Test 3: API Progress Polling</h3>
            <div class="progress mb-3" style="height: 30px;">
                <div id="progressBar2" class="progress-bar progress-bar-striped" 
                     role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    <span id="progressText2">0%</span>
                </div>
            </div>
            <div id="stepText" class="text-muted mb-2">Ready to start...</div>
            <button id="testBtn3" class="btn btn-warning">Test API Progress</button>
            <button id="stopBtn3" class="btn btn-danger ms-2">Stop</button>
        </div>
        
        <div class="progress-container">
            <h3>Debug Info</h3>
            <pre id="debugInfo" class="bg-light p-3" style="font-size: 12px;"></pre>
        </div>
    </div>

    <script>
        let progressInterval1 = null;
        let progressInterval2 = null;
        
        // Test 1: Basic progress bar animation
        document.getElementById('testBtn1').addEventListener('click', function() {
            let progress = 0;
            const bar = document.getElementById('progressBar1');
            const text = document.getElementById('progressText1');
            
            if (progressInterval1) {
                clearInterval(progressInterval1);
            }
            
            progressInterval1 = setInterval(() => {
                progress += Math.random() * 10;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(progressInterval1);
                }
                
                bar.style.width = progress + '%';
                bar.setAttribute('aria-valuenow', progress);
                text.textContent = Math.round(progress) + '%';
                
                updateDebug(`Test 1 Progress: ${Math.round(progress)}%`);
            }, 200);
        });
        
        // Test 2: Spinner toggle
        document.getElementById('testBtn2').addEventListener('click', function() {
            const spinner1 = document.getElementById('spinner1');
            const spinner2 = document.getElementById('spinner2');
            
            if (spinner1.style.display === 'none') {
                spinner1.style.display = 'inline-block';
                spinner2.style.display = 'inline-block';
                updateDebug('Spinners: SHOWN');
            } else {
                spinner1.style.display = 'none';
                spinner2.style.display = 'none';
                updateDebug('Spinners: HIDDEN');
            }
        });
        
        // Test 3: API progress polling
        document.getElementById('testBtn3').addEventListener('click', function() {
            const bar = document.getElementById('progressBar2');
            const text = document.getElementById('progressText2');
            const stepText = document.getElementById('stepText');
            
            if (progressInterval2) {
                clearInterval(progressInterval2);
            }
            
            let pollCount = 0;
            updateDebug('Starting API progress polling...');
            
            progressInterval2 = setInterval(async () => {
                try {
                    pollCount++;
                    const response = await fetch('/casestrainer/api/processing_progress');
                    const data = await response.json();
                    
                    updateDebug(`Poll ${pollCount}: ${JSON.stringify(data, null, 2)}`);
                    
                    if (data.progress !== undefined) {
                        bar.style.width = data.progress + '%';
                        bar.setAttribute('aria-valuenow', data.progress);
                        text.textContent = data.progress + '%';
                        stepText.textContent = data.current_step || 'Unknown step';
                        
                        // Add animation class
                        if (data.progress < 100) {
                            bar.classList.add('progress-bar-animated');
                        } else {
                            bar.classList.remove('progress-bar-animated');
                        }
                    }
                    
                } catch (error) {
                    updateDebug(`API Error: ${error.message}`);
                }
            }, 500);
        });
        
        document.getElementById('stopBtn3').addEventListener('click', function() {
            if (progressInterval2) {
                clearInterval(progressInterval2);
                progressInterval2 = null;
                updateDebug('API polling stopped');
            }
        });
        
        function updateDebug(message) {
            const debugInfo = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.textContent += `[${timestamp}] ${message}\n`;
            debugInfo.scrollTop = debugInfo.scrollHeight;
        }
        
        // Initial debug info
        updateDebug('Debug UI loaded successfully');
        updateDebug('Testing progress bar and spinner functionality...');
    </script>
</body>
</html>
