<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend Submission Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .input-section { background-color: #f8f9fa; padding: 20px; }
        textarea { width: 100%; height: 150px; margin: 10px 0; }
        button { padding: 10px 20px; margin: 10px 5px; }
        .results { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>üîß Frontend Submission Test</h1>
    
    <div class="test-section input-section">
        <h2>üìù Test Text Submission</h2>
        <p>Submit the test paragraph to see if clustering issues are resolved:</p>
        
        <textarea id="testText" placeholder="Enter test text here...">In re Vulnerable Adult Petition for Knight, 178 Wn. App. 929, 317 P.3d 1068 (2014). In re Marriage of Black, 188 Wn.2d 114 (2014). Blackmon v. Blackmon, 155 Wn. App. 715, 230 P.3d 233 (2010). Blackmon v. Blackmon, 155 Wn. App. 715, 392 P.3d 1041 (2017).</textarea>
        
        <div>
            <button onclick="submitToFrontend()">Submit to Frontend</button>
            <button onclick="submitToBackend()">Submit to Backend</button>
            <button onclick="clearResults()">Clear Results</button>
        </div>
    </div>
    
    <div id="results" class="test-section">
        <h2>üìã Test Results</h2>
        <div id="test-output"></div>
    </div>
    
    <script>
        function submitToFrontend() {
            const output = document.getElementById('test-output');
            output.innerHTML = '<p>üîÑ Submitting to frontend at http://localhost:8080...</p>';
            
            // Open frontend in new tab with instructions
            const frontendUrl = 'http://localhost:8080';
            const newTab = window.open(frontendUrl, '_blank');
            
            if (newTab) {
                output.innerHTML += `
                    <div class="test-section success">
                        <h3>‚úÖ Frontend Opened</h3>
                        <p>Frontend opened in new tab. Please:</p>
                        <ol>
                            <li>Copy the test text from the textarea above</li>
                            <li>Paste it into the frontend text input</li>
                            <li>Click "Analyze"</li>
                            <li>Check if clustering issues are resolved (no N/A values)</li>
                        </ol>
                        <p><strong>Expected Results:</strong></p>
                        <ul>
                            <li>6 citations should be found</li>
                            <li>4 clusters should be created</li>
                            <li>No N/A values should appear</li>
                            <li>Citations should be properly grouped</li>
                        </ul>
                    </div>
                `;
            } else {
                output.innerHTML += `
                    <div class="test-section error">
                        <h3>‚ùå Failed to Open Frontend</h3>
                        <p>Please manually open <a href="${frontendUrl}" target="_blank">${frontendUrl}</a></p>
                    </div>
                `;
            }
        }
        
        function submitToBackend() {
            const output = document.getElementById('test-output');
            const text = document.getElementById('testText').value;
            
            output.innerHTML = '<p>üîÑ Submitting to backend...</p>';
            
            fetch('http://localhost:5000/casestrainer/api/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ text: text })
            })
            .then(response => response.json())
            .then(data => {
                output.innerHTML = `
                    <div class="test-section success">
                        <h3>‚úÖ Backend Response</h3>
                        <p><strong>Status:</strong> ${data.status}</p>
                        <p><strong>Citations found:</strong> ${data.result?.citations?.length || 0}</p>
                        <p><strong>Clusters found:</strong> ${data.result?.clusters?.length || 0}</p>
                        
                        <h4>üìä Citations:</h4>
                        <div style="max-height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;">
                            <pre>${JSON.stringify(data.result?.citations, null, 2)}</pre>
                        </div>
                        
                        <h4>üìä Clusters:</h4>
                        <div style="max-height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;">
                            <pre>${JSON.stringify(data.result?.clusters, null, 2)}</pre>
                        </div>
                    </div>
                `;
            })
            .catch(error => {
                output.innerHTML = `
                    <div class="test-section error">
                        <h3>‚ùå Backend Error</h3>
                        <p>Error: ${error.message}</p>
                        <p>Make sure the backend is running on port 5000.</p>
                    </div>
                `;
            });
        }
        
        function clearResults() {
            document.getElementById('test-output').innerHTML = '';
        }
    </script>
</body>
</html>
